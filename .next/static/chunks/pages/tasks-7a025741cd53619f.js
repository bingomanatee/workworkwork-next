(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[521],{2203:function(a,b,c){"use strict";var d=c(9499),e=c(9359),f=c(4915),g=c(5170),h=c(5893);function i(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}var j=function(a){var b=a.data,c=a.cols,j=a.tableParams;return b?(0,h.jsx)(e.w,function(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?i(Object(c),!0).forEach(function(b){(0,d.Z)(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):i(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}({fill:!0,sort:!0,columns:c,data:b},void 0===j?{}:j)):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(f.$,{}),(0,h.jsx)(g.n,{size:"small",children:"Loading..."})]})};b.Z=j},5165:function(a,b,c){"use strict";var d=c(8999),e=c(5591),f=c(846),g=c(7294),h=c(5893),i=function(a){var b=a.children,c=a.id,i=a.onClick,j=a.label;return(0,h.jsx)(f.z,{color:"brand",icon:void 0!==c&&c?(0,h.jsx)(d.I,{}):(0,h.jsx)(e.m,{}),type:"button",onClick:i,label:j||g.Children.toArray(b)[0]})};b.Z=i},7131:function(a,b,c){"use strict";c.d(b,{Z:function(){return r}});var d=c(975),e=c(211),f=c(9019),g=c(4689),h=c(4923),i=c(8769),j=c(7294),k=c(585),l=c(846),m=c(5709),n=c(5893),o=function(a){var b=a.onClick;return(0,n.jsx)(l.z,{plain:!0,icon:(0,n.jsx)(m.x,{}),onClick:b})},p=c(7403),q=c(6018),r=function(a){var b=a.id,c=a.update,l=(0,j.useContext)(k.Z),m=l.base.table("tasks"),r=(0,j.useState)([]),s=r[0],t=r[1],u=(0,j.useState)(m.createData({})),v=u[0],w=u[1],x=(0,j.useState)({valid:!1}),y=x[0],z=x[1];return(0,j.useEffect)(function(){b&&l.getTask(b).then(function(a){return(console.log("retrieved record for id",a),a)?(console.log("record is ",a),w(l.base.table("task_types").createData(a.data))):c(!1)});var a=l.base.stream({tableName:"task_types"},function(a){t(a.map(function(a){return a.data}))});return l.pollTaskTypes(),function(){a.unsubscribe()}},[l,b]),(0,n.jsxs)(d.x,{pad:"large",fill:!0,children:[(0,n.jsxs)(d.x,{direction:"row",align:"between",children:[(0,n.jsx)(e.X,{level:2,children:"Create a new Task"}),(0,n.jsx)(o,{onClick:function(){return c(!1)}})]}),(0,n.jsxs)(f.l,{style:{minWidth:"80vw",minHeight:"80vh"},value:v,onValidate:z,validate:"change",onChange:w,onSubmit:function(a){var d=a.value;l.saveTask(d,b).then(function(){return c(!0)})},children:[(0,n.jsx)(g.W,{name:"task_type_id",htmlFor:"task_type-input-id",label:"Type",children:(0,n.jsx)(h.P,{id:"task_type-input-id",options:s,labelKey:"name",valueKey:{key:"id",reduce:!0},name:"task_type_id",children:function(a,b,c,d){var e=d.selected;return(0,n.jsx)(p.Z,{selected:e,label:a.name})}})}),(0,n.jsx)(g.W,{name:"notes",htmlFor:"notes-input-id",label:"Notes",children:(0,n.jsx)(i.K,{id:"notes-input-id",name:"notes"})}),(0,n.jsx)(d.x,{direction:"row",gap:"medium",children:(0,n.jsx)(q.Z,{id:b,valid:y.valid})})]})]})}},7403:function(a,b,c){"use strict";var d=c(975),e=c(9517);c(7294);var f=c(5893),g=function(a){var b=a.selected,c=a.label;return(0,f.jsx)(d.x,{pad:"2px",children:(0,f.jsx)(e.x,{weight:b?"bold":"normal",children:c})})};b.Z=g},6018:function(a,b,c){"use strict";var d=c(6074),e=c(5591),f=c(846),g=c(5893),h=function(a){var b=a.id,c=a.valid,h=a.saving;return(0,g.jsx)(f.z,{disabled:h||!c,type:"submit",icon:b?(0,g.jsx)(d.v,{}):(0,g.jsx)(e.m,{}),primary:!0,label:"Submit"})};b.Z=h},4432:function(a,b,c){"use strict";var d=c(975),e=c(211),f=c(3512),g=c(1664),h=c.n(g),i=c(5165),j=c(5893),k=function(a){var b=a.label,c=a.level,g=a.children,k=a.onCreate,l=a.createId,m=a.createLabel;return(0,j.jsxs)(d.x,{justify:"between",align:"center",direction:"row",fill:"horizontal",gap:"small",children:[(0,j.jsx)(h(),{href:"/",children:(0,j.jsx)(f.S,{})}),(0,j.jsx)(e.X,{level:void 0===c?1:c,children:b}),(0,j.jsx)(d.x,{direction:"row-reverse",fill:"horizontal",children:k?(0,j.jsx)(i.Z,{onClick:k,label:void 0===m?"":m,id:l}):g})]})};b.Z=k},8592:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return M}});var d=c(6835),e=c(7294),f=c(9517),g=c(975),h=c(5009),i=c(7484),j=c.n(i),k=c(4110),l=c.n(k),m=c(158),n=c(8517),o=c(585),p=c(7131),q=c(4432),r=c(2203),s=c(9499),t=c(8254),u=c.n(t),v=c(5631),w=c(846),x=c(211),y=c(3627),z=c(7),A=c(1661),B=c(9852),C=c(5893),D=function(a){var b=a.data,c=a.skipIfEmpty,d=void 0===c||c,e=a.expand,h=a.ifEmpty,i=void 0===h?"":h,j=a.size,k=void 0===j?"small":j;if(!b&&d)return i;try{if(!(void 0===e||e)){var l=JSON.stringify(b);return(0,C.jsx)(g.x,{fill:"horizontal",overflow:"auto",children:(0,C.jsx)(f.x,{as:"pre",size:k,truncate:!0,children:l})})}var m=JSON.stringify(b,!0,2);return(0,C.jsx)(g.x,{fill:"horizontal",overflow:"auto",children:(0,C.jsx)(f.x,{size:k,children:(0,C.jsx)("pre",{children:m})})})}catch(n){return d?i:(0,C.jsx)(g.x,{fill:"horizontal",children:i})}},E=function(a){var b=a.event;return(0,C.jsxs)("div",{children:[(0,C.jsx)(f.x,{size:"small",children:b.event}),(0,C.jsx)(D,{data:b.data})]})},F=function(a){var b=a.task;return(0,C.jsx)(g.x,{fill:"both",style:{maxHeight:"20rem"},overflow:"scroll",children:(0,C.jsx)(g.x,{fill:"both",children:b.task_events.map(function(a){return(0,C.jsx)(E,{event:a},a.id)})})})},G=F;function H(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function I(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?H(Object(c),!0).forEach(function(b){(0,s.Z)(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):H(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}n._G.binaryOperator;var J={rows:["auto","auto"],columns:["20rem","auto"],areas:[{name:"title",start:[0,0],end:[0,0]},{name:"data",start:[0,1],end:[0,1]},{name:"children",start:[1,0],end:[1,1]}]},K=function(a){var b=a.child,c=(0,e.useContext)(o.Z),d=b.task_type_id,h=c.base.table("task_types").getData(d),i=(0,e.useState)(!1),j=i[0],k=i[1],l=(0,e.useMemo)(function(){return function(){k(!j)}},[j]),m=(0,e.useMemo)(function(){return c.taskChildrenCount(b.id)},[b]);return(0,C.jsx)(g.x,{margin:"small",children:(0,C.jsxs)(v.r,I(I({},J),{},{children:[(0,C.jsxs)(g.x,{gridArea:"title",children:[(0,C.jsxs)(g.x,{direction:"row",align:"center",gap:"medium",fill:"horizontal",children:[(0,C.jsx)(w.z,{icon:j?(0,C.jsx)(y.R,{}):(0,C.jsx)(z.I,{}),onClick:l}),(0,C.jsxs)(x.X,{level:3,style:{whiteSpace:"nowrap"},children:[" ",h?h.name:"?"]}),m?(0,C.jsx)(B.ZP,{count:m,effect:B.Qm.SCALE}):"",(0,C.jsx)(f.x,{size:"small",children:b.status})]}),(0,C.jsx)(f.x,{size:"xsmall",children:b.id})]}),(0,C.jsx)(g.x,{gridArea:"data",overflow:"auto",children:j?(0,C.jsxs)(g.x,{direction:"column",gap:"small",children:[(0,C.jsx)(D,{data:b.data}),b.task_events.length?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(x.X,{level:3,children:"Events"}),(0,C.jsx)(G,{task:b})]}):"",(0,C.jsx)(w.z,{icon:(0,C.jsx)(A.h,{}),onClick:function(){return c.repeatTask(b.id)},label:"Repeat"})]}):""}),(0,C.jsx)(g.x,{gridArea:"children",overflow:"hidden",children:(0,C.jsx)(L,{root:b.id})})]}))})},L=function(a){var b=a.root,c=(0,e.useContext)(o.Z).taskChildrenFor(b).map(function(a){return a.data});return console.log("task children for",b,":",c),u()(c.map(function(a){return I(I({},a),{},{createdTime:j()(a.createdAt).unix()})}),"createdTime").reverse().map(function(a){return(0,C.jsx)(K,{child:a},a.id)})};n._G.binaryOperator,m.kE.FormEnum,j().extend(l());var M=function(){var a=(0,e.useState)(null),b=a[0],c=a[1],i=(0,e.useState)(null),k=i[0],l=i[1],m=(0,e.useState)(!1);m[0],m[1];var n=e.useState(),s=(0,d.Z)(n,2),t=s[0],u=s[1],v=(0,e.useContext)(o.Z),w=[{property:"id",primary:!0,header:"ID",size:"12rem",render:function(a){var b=a.id;return(0,C.jsx)(f.x,{truncate:!0,children:b})}},{property:"task_type_id",header:"Type",render:function(a){var c=a.task_type_id,d=b.find(function(a){return a.id===c});return d?d.name:"?"}},{property:"createdAt",header:"Created At",size:"20rem",render:function(a){var b=a.createdAt;if(!b)return"";var c=b;return"string"==typeof c&&(c=new Date(c)),j()(c).format("D.M.YY - HH:mm")}},{property:"status",header:"Status"},{property:"childTasks",header:"Children",size:"6rem",render:function(a){var b=a.id;return v.taskChildrenCount(b)||""}},{property:"data",header:"Data",render:function(a){var b=a.data;return(0,C.jsx)(D,{expand:!1,data:b,size:"xsmall",else:"---"})}}];return(0,e.useEffect)(function(){var a=v.base.stream({tableName:"tasks"},function(a){l(a.map(function(a){return a.data}))}),b=v.base.stream({tableName:"task_types"},function(a){c(a.map(function(a){return a.data}))}),d=null;function e(){v.pollTasks(),d=setTimeout(function(){e()},6e4)}return e(),v.pollTaskTypes(),function(){clearTimeout(d),a.unsubscribe(),b.unsubscribe()}},[v]),(0,C.jsxs)(g.x,{pad:"large",children:[(0,C.jsx)(q.Z,{label:"Tasks",createLabel:"Create Task",onCreate:function(){return u(!0)}}),(0,C.jsx)(g.x,{align:"start",children:(0,C.jsx)(r.Z,{data:k&&b&&k.filter(function(a){return!a.parent_task_id}),cols:w,tableParams:{sort:{direction:"desc",property:"createdAt"},rowDetails:function(a){return(0,C.jsxs)(g.x,{children:[(0,C.jsx)(G,{task:a}),(0,C.jsx)(L,{root:a.id})]})}}})}),t&&(0,C.jsx)(h.m,{children:(0,C.jsx)(p.Z,{update:function(){u(!1)}})})]})}},8446:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks",function(){return c(8592)}])}},function(a){a.O(0,[517,389,762,652,783,254,430,774,888,179],function(){var b;return a(a.s=8446)}),_N_E=a.O()}])